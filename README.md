# Antigravity Context CLI (`ctx-cli`)

A CLI tool that parses intent artifacts and code deltas from any AI coding assistant to generate human-quality commit messages and PR descriptions.

## Features

- **Universal AI Support**: Works with any AI coding assistant through a provider-based architecture
- **Context-Aware**: Reads intent artifacts (task lists, plans, decisions) to understand the *why* behind your changes
- **Diff-Aware**: Analyzes your staged changes (`git diff --staged`) to understand the *what*
- **AI-Powered**: Uses LLMs to synthesize this information into semantic commit messages and comprehensive PR descriptions

### Supported AI Assistants

- ✅ **Antigravity Agent** - Reads task.md and implementation_plan.md from brain directory
- 🚧 **Cursor IDE** - Coming soon
- 🚧 **Aider** - Coming soon

## Setup

1.  **Install Dependencies**:
    ```bash
    npm install
    ```

2.  **Configure API Key**:
    Create a `.env` file in the root directory.
    
    **For Standard OpenAI:**
    ```env
    OPENAI_API_KEY=sk-your-api-key-here
    OPENAI_MODEL=gpt-4o-mini
    ```
    
    **For Azure OpenAI:**
    ```env
    AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
    AZURE_OPENAI_API_KEY=your-azure-api-key
    AZURE_OPENAI_DEPLOYMENT=your-deployment-name
    AZURE_OPENAI_API_VERSION=2024-02-15-preview
    ```
    
    > **Note**: The tool automatically detects which provider to use. If `AZURE_OPENAI_ENDPOINT` is set, it will use Azure OpenAI; otherwise, it uses standard OpenAI.
    
    **Optional Settings:**
    ```env
    # Specify which AI assistant to use (auto-detect if not set)
    # INTENT_PROVIDER=antigravity
    
    # Custom Antigravity brain directory
    # ANTIGRAVITY_BRAIN_DIR=C:/Users/username/.gemini/antigravity/brain
    ```

3.  **Build**:
    ```bash
    npm run build
    ```

## Usage

### Generate Commit Message

Stage your files first:
```bash
git add .
```

Run the `commit` command:
```bash
npx ctx commit
```
Options:
- `--no-tradeoffs`: Skip the "Trade-offs" section.
- `--ai-attribution`: Add a "Generated by ctx-cli" footer.
- `--dry-run`: Print the generated message to stdout and exit.
- `-a`, `--all`: Stage all changes (untracked + modified) before generating the message.

### Generate PR Description

Run the `pr` command (compares `HEAD` to `main` by default):
```bash
npx ctx pr
```
Options:
- `--no-tradeoffs`
- `--ai-attribution`

## How it Works

ctx-cli uses an **Intent Provider** architecture to support multiple AI coding assistants:

1.  **Provider Detection**: The tool auto-detects which AI assistant you're using by checking for specific artifacts (e.g., Antigravity brain directory, Aider chat logs, Cursor rules).
2.  **Intent Collection**: The detected provider collects and normalizes intent data into a common schema with goals, tasks, decisions, trade-offs, and constraints.
3.  **Diff Analysis**: Git changes are extracted from `git diff --staged` (for commits) or branch comparisons (for PRs).
4.  **Synthesis**: The normalized intent context and diff are sent to an LLM to generate human-quality commit messages or PR descriptions.

### Adding New Providers

To support a new AI assistant, implement the `IntentProvider` interface:

```typescript
interface IntentProvider {
  name: string;
  detect(): Promise<boolean>;
  collect(): Promise<IntentBundle | null>;
}
```

See `src/providers/` for examples.